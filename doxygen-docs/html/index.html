<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SSS - S3 Toolkit: S3 Toolkit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SSS - S3 Toolkit
   &#160;<span id="projectnumber">0.9.4</span>
   </div>
   <div id="projectbrief">S3 client library and applications</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">S3 Toolkit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a> C++ client library and tools. Originally developed to test <em>Ceph</em> object storage, parallel transfers between Lustre and <em>Ceph</em> on high speed networks, and learn the S3 API.</p>
<p>All the code is tested on MacOS (x86 and ARM) and Linux SuSE and Ubuntu, x86 only.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Library</h1>
<ul>
<li><code>libs3client</code>: high level functions to sign and send requests and perform parallel uploads/downloads.</li>
</ul>
<p>S3 API accessible through the <code>libs3client</code> library, see <code><a class="el" href="s3-api_8h.html" title="declarations of S3Api class.">s3-api.h</a></code> and <code><a class="el" href="s3-client_8h.html" title="declaration of functions and data types for sending S3 requests, signing URLs and downloading and upl...">s3-client.h</a></code> includes.</p>
<p>Check out the <code>app</code> and <code>test</code> folders for usage examples.</p>
<p>A small subset of the S3 action is implemented, but any request can be sent through the <code>S3API::Send</code> method and <code>SendS3Request</code> function.</p>
<p>XML requests and responses can be generated and parsed using the provide high-level XML parsing and generation functions; see <code>Parsing</code> module in the Doxygen-generated API documentation or look into the <code>xml_path.h</code> and <code>test/xml-parse-test.cpp</code> files.</p>
<p>Parallel upload and download works best when reading/writing from SSDs or RAID &amp; parallel file-systems with <code>stripe size = N * (part size)</code>.</p>
<p>The code is <code>C++17</code> compliant.</p>
<p>When disabling S3v4 signing the library can be used as a generic HTTP client library.</p>
<p>Work to enable multi-level asynchronous operations is ongoing: each thread will be using async I/O for sending multiple concurrent requests.</p>
<p>Parallel upload/download using MPI and integration with ADIOS are being experimented as well in separate repositories.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Applications</h1>
<ul>
<li><code>s3-client</code>: send requests and print raw responses</li>
<li><code>s3-presign</code>: generate pre-signed <code>URL</code></li>
<li><code>s3-upload</code>: (single file) parallel upload</li>
<li><code>s3-download</code>: (singe file) parallel download</li>
<li><code>s3-gen-credentials</code>: generate access and secret keys</li>
</ul>
<p>Launch without arguments to see options.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Build and install</h1>
<p>The <code>install.sh</code> script includes the code for checking out the code, building and installing to a user specified path. Just <a href="https://raw.githubusercontent.com/uv-cpp/s3client/main/install.sh">download</a> and run.</p>
<div class="fragment"><div class="line">bash ./install.sh &lt;install path&gt;</div>
</div><!-- fragment --><p><code>libcurl</code> must be available for the code to build.</p>
<p>...or build it manually</p>
<p>E.g. Building and installing a release version under <code>$HOME/.local</code> (default is <code>/usr/local</code>):</p>
<ol type="1">
<li><code>git clone --recurse-submodules <a href="https://github.com/uv-cpp/s3client.git">https://github.com/uv-cpp/s3client.git</a></code></li>
<li><code>mkdir -p s3client/build</code></li>
<li><code>cd s3client/build</code></li>
<li><code>cmake ../ -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=~/.local</code>;</li>
<li><code>make -j 8</code></li>
<li><code>make install</code></li>
</ol>
<p>Include files are found under <code>${CMAKE_INSTALL_PREFIX}/include/s3client</code>. The library is found under <code>${CMAKE_INSTALL_PREFIX}/lib</code> and the executables under <code>${CMAKE_INSTALL_PREFIX}/bin</code>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Compilation options</h2>
<p>By default the library and all the command line tools and the S3 API extensions are built.</p>
<p>To disable building the command line tools set <code>APPS=OFF</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Test</h1>
<p>In order to test the tools and API you need access to an S3 storage service. One option is to use the free <em>play.min.io</em> service, another option is to configure a local instance of the <em>minio</em> server.</p>
<p>The access and secret keys for <em>play.min.io</em> are stored inside the <code>~/.mc/config.json</code> files configured after installing the the <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">minio client</a>.</p>
<p>The script <code>minio_podman_setup.sh</code> downloads configures and runs a minio server instance inside a contatiner using <em>podman</em>.</p>
<p>Run the script after building all the applications and making sure that the <code>s3-gen-credentials</code> executable is findable through the <code>PATH</code> variable.</p>
<p>Usage </p><div class="fragment"><div class="line">./minio_podman_setup.sh &lt;minio alias&gt; &lt;data path&gt;</div>
</div><!-- fragment --><p> Run </p><div class="fragment"><div class="line">chmod u+x ./minio_podman_setup.sh</div>
<div class="line">./minio_podman_setup.sh myalias ~/tmp/minio_data</div>
</div><!-- fragment --><p>In cases where the <em>minio</em> server is already installed and available, you can invoke the <code>minio_run_server.sh</code> instead.</p>
<div class="fragment"><div class="line">chmod u+x ./minio_run_server.sh</div>
<div class="line">./minio_run_server.sh myalias ~/tmp/minio_data</div>
</div><!-- fragment --><p>Both scripts ouput access, secret and URL which should be stored into environment variables.</p>
<p>The <code>test</code> directory includes tests for the high level interface and the S3 API.</p>
<p>All tests require passing the name of the environment variables storing access, secret and endpoint URL information.</p>
<p>The provided <code>.sh</code> scripts inside the <code>test</code> directory can run all the tests at once.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
License</h1>
<p>This software is distributed under the BSD three-clause license and has dependencies on the following software libraries:</p>
<ul>
<li><em>libcurl</em> - distributed unded the curl license, derived from MIT/X</li>
<li><em>Lyra</em>, by Rene Rivera - distributed under the Boost license version 1.0</li>
<li><em>Tinyxml2</em> - zlib (included in source tree)</li>
<li><em>Doxygen Awesome</em> - MIT</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
Sending S3 requests</h1>
<p>The <code>s3-client</code> application is just a wrapper around the <code>sss::SendS3Request</code> function.</p>
<p>Sample requests are shown below, look here for a complete list:</p>
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html">https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html</a></p>
<h2><a class="anchor" id="autotoc_md14"></a>
List bucket content</h2>
<p>Command line:</p>
<div class="fragment"><div class="line">s3-client -a $S3TEST_ACCESS -s $S3TEST_SECRET -e $S3TEST_URL \</div>
<div class="line">          -b bucket1 -m get</div>
</div><!-- fragment --><p>C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="s3-client_8h.html">s3-client.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">S3ClientConfig args;</div>
<div class="line">args.accessKey = <span class="stringliteral">&quot;Naowkmo0786XzwrF&quot;</span>;</div>
<div class="line">args.secretKey = <span class="stringliteral">&quot;gpM6KV0Andtn2myBWePjoHXmSBy71UDK&quot;</span>;</div>
<div class="line">args.endpoint = <span class="stringliteral">&quot;http://127.0.0.1:9000&quot;</span>;</div>
<div class="line">args.bucket = <span class="stringliteral">&quot;bucket1&quot;</span> </div>
<div class="line">args.method = <span class="stringliteral">&quot;GET&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classsss_1_1WebClient.html">sss::WebClient</a> req = <a class="code" href="group__S3Client.html#ga5a769be8fbc874bad858ea95743e5643">sss::SendS3Request</a>(s3args);</div>
<div class="line"> </div>
<div class="line">cout &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#ac9e82fc4b56b142d91f9b104f5266f91">GetContentText</a>() &lt;&lt; endl;</div>
<div class="ttc" id="aclasssss_1_1WebClient_html"><div class="ttname"><a href="classsss_1_1WebClient.html">sss::WebClient</a></div><div class="ttdoc">Send web requests through libcurl.</div><div class="ttdef"><b>Definition:</b> webclient.h:125</div></div>
<div class="ttc" id="aclasssss_1_1WebClient_html_ac9e82fc4b56b142d91f9b104f5266f91"><div class="ttname"><a href="classsss_1_1WebClient.html#ac9e82fc4b56b142d91f9b104f5266f91">sss::WebClient::GetContentText</a></div><div class="ttdeci">std::string GetContentText() const</div><div class="ttdoc">Get response body as text.</div><div class="ttdef"><b>Definition:</b> webclient.cpp:432</div></div>
<div class="ttc" id="agroup__S3Client_html_ga5a769be8fbc874bad858ea95743e5643"><div class="ttname"><a href="group__S3Client.html#ga5a769be8fbc874bad858ea95743e5643">sss::SendS3Request</a></div><div class="ttdeci">WebClient SendS3Request(S3ClientConfig)</div><div class="ttdoc">Send S3 request to endpoint.</div><div class="ttdef"><b>Definition:</b> s3-client.cpp:82</div></div>
<div class="ttc" id="as3-client_8h_html"><div class="ttname"><a href="s3-client_8h.html">s3-client.h</a></div><div class="ttdoc">declaration of functions and data types for sending S3 requests, signing URLs and downloading and upl...</div></div>
</div><!-- fragment --><p> Output:</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div>
<div class="line">&lt;ListBucketResult xmlns=&quot;http://s3.amazonaws.com/doc/2006-03-01/&quot;&gt;</div>
<div class="line">   &lt;Name&gt;bucket1&lt;/Name&gt;</div>
<div class="line">   &lt;Prefix /&gt;</div>
<div class="line">   &lt;Marker /&gt;</div>
<div class="line">   &lt;MaxKeys&gt;1000&lt;/MaxKeys&gt;</div>
<div class="line">   &lt;Delimiter /&gt;</div>
<div class="line">   &lt;IsTruncated&gt;false&lt;/IsTruncated&gt;</div>
<div class="line">   &lt;Contents&gt;</div>
<div class="line">      &lt;Key&gt;data&lt;/Key&gt;</div>
<div class="line">      &lt;LastModified&gt;2022-12-05T06:00:06.188Z&lt;/LastModified&gt;</div>
<div class="line">      &lt;ETag&gt;&quot;d41d8cd98f00b204e9800998ecf8427e&quot;&lt;/ETag&gt;</div>
<div class="line">      &lt;Size&gt;0&lt;/Size&gt;</div>
<div class="line">      &lt;Owner&gt;</div>
<div class="line">         &lt;ID&gt;02d6176db174dc93cb1b899f7c6078f08654445fe8cf1b6ce98d8855f66bdbf4&lt;/ID&gt;</div>
<div class="line">         &lt;DisplayName&gt;minio&lt;/DisplayName&gt;</div>
<div class="line">      &lt;/Owner&gt;</div>
<div class="line">      &lt;StorageClass&gt;STANDARD&lt;/StorageClass&gt;</div>
<div class="line">   &lt;/Contents&gt;</div>
<div class="line">   &lt;Contents&gt;</div>
<div class="line">      &lt;Key&gt;data2&lt;/Key&gt;</div>
<div class="line">      &lt;LastModified&gt;2022-12-05T06:57:48.013Z&lt;/LastModified&gt;</div>
<div class="line">      &lt;ETag&gt;&quot;3a54774d91ce84eb33f49681664f93ba&quot;&lt;/ETag&gt;</div>
<div class="line">      &lt;Size&gt;4&lt;/Size&gt;</div>
<div class="line">      &lt;Owner&gt;</div>
<div class="line">         &lt;ID&gt;02d6176db174dc93cb1b899f7c6078f08654445fe8cf1b6ce98d8855f66bdbf4&lt;/ID&gt;</div>
<div class="line">         &lt;DisplayName&gt;minio&lt;/DisplayName&gt;</div>
<div class="line">      &lt;/Owner&gt;</div>
<div class="line">      &lt;StorageClass&gt;STANDARD&lt;/StorageClass&gt;</div>
<div class="line">   &lt;/Contents&gt;</div>
<div class="line">   &lt;Contents&gt;</div>
<div class="line">      &lt;Key&gt;data3&lt;/Key&gt;</div>
<div class="line">      &lt;LastModified&gt;2022-12-05T07:36:38.611Z&lt;/LastModified&gt;</div>
<div class="line">      &lt;ETag&gt;&quot;e2fc714c4727ee9395f324cd2e7f331f&quot;&lt;/ETag&gt;</div>
<div class="line">      &lt;Size&gt;4&lt;/Size&gt;</div>
<div class="line">      &lt;Owner&gt;</div>
<div class="line">         &lt;ID&gt;02d6176db174dc93cb1b899f7c6078f08654445fe8cf1b6ce98d8855f66bdbf4&lt;/ID&gt;</div>
<div class="line">         &lt;DisplayName&gt;minio&lt;/DisplayName&gt;</div>
<div class="line">      &lt;/Owner&gt;</div>
<div class="line">      &lt;StorageClass&gt;STANDARD&lt;/StorageClass&gt;</div>
<div class="line">   &lt;/Contents&gt;</div>
<div class="line">   &lt;Contents&gt;</div>
<div class="line">      &lt;Key&gt;object&lt;/Key&gt;</div>
<div class="line">      &lt;LastModified&gt;2022-12-03T03:24:52.893Z&lt;/LastModified&gt;</div>
<div class="line">      &lt;ETag&gt;&quot;79c1833d66d63cf1d4f4b2284ac1f9b2&quot;&lt;/ETag&gt;</div>
<div class="line">      &lt;Size&gt;1050621&lt;/Size&gt;</div>
<div class="line">      &lt;Owner&gt;</div>
<div class="line">         &lt;ID&gt;02d6176db174dc93cb1b899f7c6078f08654445fe8cf1b6ce98d8855f66bdbf4&lt;/ID&gt;</div>
<div class="line">         &lt;DisplayName&gt;minio&lt;/DisplayName&gt;</div>
<div class="line">      &lt;/Owner&gt;</div>
<div class="line">      &lt;StorageClass&gt;STANDARD&lt;/StorageClass&gt;</div>
<div class="line">   &lt;/Contents&gt;</div>
<div class="line">   &lt;Contents&gt;</div>
<div class="line">      &lt;Key&gt;presign&lt;/Key&gt;</div>
<div class="line">      &lt;LastModified&gt;2022-12-03T02:54:16.526Z&lt;/LastModified&gt;</div>
<div class="line">      &lt;ETag&gt;&quot;b22ca8f1ddff8ec023cb0d074f7da15e&quot;&lt;/ETag&gt;</div>
<div class="line">      &lt;Size&gt;277175&lt;/Size&gt;</div>
<div class="line">      &lt;Owner&gt;</div>
<div class="line">         &lt;ID&gt;02d6176db174dc93cb1b899f7c6078f08654445fe8cf1b6ce98d8855f66bdbf4&lt;/ID&gt;</div>
<div class="line">         &lt;DisplayName&gt;minio&lt;/DisplayName&gt;</div>
<div class="line">      &lt;/Owner&gt;</div>
<div class="line">      &lt;StorageClass&gt;STANDARD&lt;/StorageClass&gt;</div>
<div class="line">   &lt;/Contents&gt;</div>
<div class="line">&lt;/ListBucketResult&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Extract bytes 100-150 from object</h2>
<p>Command line:</p>
<div class="fragment"><div class="line">s3-client -a $S3TEST_ACCESS -s $S3TEST_SECRET -e $S3TEST_URL \</div>
<div class="line">          -b bucket1 -k object -m get -H &quot;Range:bytes=100-150&quot;</div>
</div><!-- fragment --><p>C++:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="s3-client_8h.html">s3-client.h</a>&quot;</span></div>
<div class="line">...</div>
<div class="line">S3ClientConfig args;</div>
<div class="line">args.accessKey = <span class="stringliteral">&quot;Naowkmo0786XzwrF&quot;</span>;</div>
<div class="line">args.secretKey = <span class="stringliteral">&quot;gpM6KV0Andtn2myBWePjoHXmSBy71UDK&quot;</span>;</div>
<div class="line">args.endpoint = <span class="stringliteral">&quot;http://127.0.0.1:9000&quot;</span>;</div>
<div class="line">args.bucket = <span class="stringliteral">&quot;bucket1&quot;</span> </div>
<div class="line">args.method = <span class="stringliteral">&quot;GET&quot;</span>;</div>
<div class="line">args.headers =  <span class="stringliteral">&quot;Range:bytes=100-150&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classsss_1_1WebClient.html">sss::WebClient</a> req = <a class="code" href="group__S3Client.html#ga5a769be8fbc874bad858ea95743e5643">sss::SendS3Request</a>(s3args);</div>
<div class="line"> </div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Status: &quot;</span> &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#acfaaa6e67fca5776a06e178833833978">StatusCode</a>() &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line"><span class="comment">// Response body</span></div>
<div class="line">cout &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#ac9e82fc4b56b142d91f9b104f5266f91">GetContentText</a>() &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line"><span class="comment">// Response header</span></div>
<div class="line"> h = req.<a class="code" href="classsss_1_1WebClient.html#a42af351286f1fa68c3385d81f0bc2015">GetHeaderText</a>() &lt;&lt; endl;</div>
<div class="ttc" id="aclasssss_1_1WebClient_html_a42af351286f1fa68c3385d81f0bc2015"><div class="ttname"><a href="classsss_1_1WebClient.html#a42af351286f1fa68c3385d81f0bc2015">sss::WebClient::GetHeaderText</a></div><div class="ttdeci">std::string GetHeaderText() const</div><div class="ttdef"><b>Definition:</b> webclient.cpp:437</div></div>
<div class="ttc" id="aclasssss_1_1WebClient_html_acfaaa6e67fca5776a06e178833833978"><div class="ttname"><a href="classsss_1_1WebClient.html#acfaaa6e67fca5776a06e178833833978">sss::WebClient::StatusCode</a></div><div class="ttdeci">long StatusCode() const</div><div class="ttdef"><b>Definition:</b> webclient.cpp:266</div></div>
</div><!-- fragment --><p>Output:</p>
<div class="fragment"><div class="line">Status: 0</div>
<div class="line"> </div>
<div class="line">!; @:OQ]qjlr</div>
<div class="line">            TlGKP{</div>
<div class="line">                  q</div>
<div class="line"> </div>
<div class="line">HTTP/1.1 206 Partial Content</div>
<div class="line">Accept-Ranges: bytes</div>
<div class="line">Content-Length: 51</div>
<div class="line">Content-Range: bytes 100-150/1050621</div>
<div class="line">Content-Security-Policy: block-all-mixed-content</div>
<div class="line">Content-Type: binary/octet-stream</div>
<div class="line">ETag: &quot;79c1833d66d63cf1d4f4b2284ac1f9b2&quot;</div>
<div class="line">Last-Modified: Sat, 03 Dec 2022 03:24:52 GMT</div>
<div class="line">Server: MinIO</div>
<div class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains</div>
<div class="line">Vary: Origin</div>
<div class="line">Vary: Accept-Encoding</div>
<div class="line">X-Amz-Request-Id: 172DD7623C30EFE8</div>
<div class="line">X-Content-Type-Options: nosniff</div>
<div class="line">X-Xss-Protection: 1; mode=block</div>
<div class="line">Date: Mon, 05 Dec 2022 08:10:53 GMT</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Store data into object</h2>
<p>Command line:</p>
<div class="fragment"><div class="line">s3-client -a $S3TEST_ACCESS -s $S3TEST_SECRET -e $S3TEST_URL \</div>
<div class="line">          -b bucket1 -k variable_name -v &quot;10,20,30&quot; -m put</div>
</div><!-- fragment --><p>C++</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="s3-client_8h.html">s3-client.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">S3ClientConfig args;</div>
<div class="line">args.accessKey = <span class="stringliteral">&quot;Naowkmo0786XzwrF&quot;</span>;</div>
<div class="line">args.secretKey = <span class="stringliteral">&quot;gpM6KV0Andtn2myBWePjoHXmSBy71UDK&quot;</span>;</div>
<div class="line">args.endpoint = <span class="stringliteral">&quot;http://127.0.0.1:9000&quot;</span>;</div>
<div class="line">args.bucket = <span class="stringliteral">&quot;bucket1&quot;</span> </div>
<div class="line">args.method = <span class="stringliteral">&quot;GET&quot;</span>;</div>
<div class="line">args.headers = <span class="stringliteral">&quot;Range:bytes=100-150&quot;</span>;</div>
<div class="line">args.method = <span class="stringliteral">&quot;PUT&quot;</span>;</div>
<div class="line">args.data = <span class="stringliteral">&quot;10,20,30&quot;</span>;  </div>
<div class="line"> </div>
<div class="line"><a class="code" href="classsss_1_1WebClient.html">sss::WebClient</a> req = <a class="code" href="group__S3Client.html#ga5a769be8fbc874bad858ea95743e5643">sss::SendS3Request</a>(s3args);</div>
<div class="line"> </div>
<div class="line">cout &lt;&lt; <span class="stringliteral">&quot;Status: &quot;</span> &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#acfaaa6e67fca5776a06e178833833978">StatusCode</a>() &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line"><span class="comment">// Response body</span></div>
<div class="line">cout &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#ac9e82fc4b56b142d91f9b104f5266f91">GetContentText</a>() &lt;&lt; endl &lt;&lt; endl;</div>
<div class="line"><span class="comment">// Response header</span></div>
<div class="line">cout &lt;&lt; req.<a class="code" href="classsss_1_1WebClient.html#a42af351286f1fa68c3385d81f0bc2015">GetHeaderText</a>() &lt;&lt; endl;</div>
</div><!-- fragment --><p>Output</p>
<div class="fragment"><div class="line">Status: 0</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">HTTP/1.1 100 Continue</div>
<div class="line"> </div>
<div class="line">HTTP/1.1 200 OK</div>
<div class="line">Accept-Ranges: bytes</div>
<div class="line">Content-Length: 0</div>
<div class="line">Content-Security-Policy: block-all-mixed-content</div>
<div class="line">ETag: &quot;9dac2971b753257ec5588962fca0503a&quot;</div>
<div class="line">Server: MinIO</div>
<div class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains</div>
<div class="line">Vary: Origin</div>
<div class="line">Vary: Accept-Encoding</div>
<div class="line">X-Amz-Request-Id: 172DD80A53A91EB8</div>
<div class="line">X-Content-Type-Options: nosniff</div>
<div class="line">X-Xss-Protection: 1; mode=block</div>
<div class="line">Date: Mon, 05 Dec 2022 08:22:55 GMT</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md17"></a>
Parallel upload</h1>
<p>Parallel uploads are supported from both file and memory in the API and command line application.</p>
<p>Command line</p>
<div class="fragment"><div class="line">s3-upload -a $S3_ACCESS -s $S3_SECRET -e $S3_URL -f myfile \</div>
<div class="line">          -b bucket2 -k key -j $NUM_JOBS -n $PARTS_PER_JOBS -r $NUM_RETRIES</div>
</div><!-- fragment --><p>C++</p>
<p>Extracted from the file transfer tests.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">  #include &lt;s3-api.h&gt;</div>
<div class="line">...</div>
<div class="line">  <span class="keywordtype">string</span> action = <span class="stringliteral">&quot;Parallel file upload&quot;</span>;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    S3DataTransferConfig c = {.accessKey = cfg.access,</div>
<div class="line">                              .secretKey = cfg.secret,</div>
<div class="line">                              .bucket = bucket,</div>
<div class="line">                              .key = key,</div>
<div class="line">                              .file = tmp.path,</div>
<div class="line">                              .endpoints = {cfg.url},</div>
<div class="line">                              .jobs = NUM_JOBS,</div>
<div class="line">                              .partsPerJob = CHUNKS_PER_JOB};</div>
<div class="line">    <span class="comment">/*auto etag =*/</span> <a class="code" href="group__S3Client.html#gac5f34efe8d5fde67f9c2c006742d6f85">Upload</a>(c);</div>
<div class="line">    S3Api s3(cfg.access, cfg.secret, cfg.url);</div>
<div class="line">    <span class="keyword">const</span> CharArray uploaded = s3.GetObject(bucket, key);</div>
<div class="line">    <span class="keywordflow">if</span> (uploaded != data)</div>
<div class="line">      <span class="keywordflow">throw</span> logic_error(<span class="stringliteral">&quot;Data verification failed&quot;</span>);</div>
<div class="line">    TestOutput(action, <span class="keyword">true</span>, TEST_PREFIX);</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception &amp;e) {</div>
<div class="line">    TestOutput(action, <span class="keyword">false</span>, TEST_PREFIX, e.what());</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__S3Client_html_gac5f34efe8d5fde67f9c2c006742d6f85"><div class="ttname"><a href="group__S3Client.html#gac5f34efe8d5fde67f9c2c006742d6f85">sss::Upload</a></div><div class="ttdeci">ETag Upload(const S3DataTransferConfig &amp;cfg, const MetaDataMap &amp;mm={}, bool sync=false)</div><div class="ttdef"><b>Definition:</b> upload-file.cpp:187</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
Parallel file download</h1>
<p>Parallel downloads are supported to both file and memory in the API.</p>
<p>Command line</p>
<div class="fragment"><div class="line">s3-download -a $S3_ACCESS -s $S3_SECRET -e $S3_URL -f myfile \</div>
<div class="line">            -b bucket2 -k key -j $NUM_JOBS -n $PARTS_PER_JOBS -r $NUM_RETRIES</div>
</div><!-- fragment --><p>C++</p>
<p>Extracted from the file transfer tests.</p>
<div class="fragment"><div class="line">...</div>
<div class="line">  #include &lt;s3-api.h&gt;</div>
<div class="line">...</div>
<div class="line">  action = <span class="stringliteral">&quot;Parallel file download&quot;</span>;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    S3DataTransferConfig c = {.accessKey = cfg.access,</div>
<div class="line">                              .secretKey = cfg.secret,</div>
<div class="line">                              .bucket = bucket,</div>
<div class="line">                              .key = key,</div>
<div class="line">                              .file = tmp.path,</div>
<div class="line">                              .endpoints = {cfg.url},</div>
<div class="line">                              .jobs = NUM_JOBS,</div>
<div class="line">                              .partsPerJob = CHUNKS_PER_JOB};</div>
<div class="line">    <a class="code" href="group__S3Client.html#gad9e1cbb4715a672101995636897814e4">Download</a>(c);</div>
<div class="line">    FILE *fi = fopen(tmp.path.c_str(), <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">    vector&lt;char&gt; input(SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (fread(input.data(), SIZE, 1, fi) != 1) {</div>
<div class="line">      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot open file for reading&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span> (input == data) {</div>
<div class="line">      TestOutput(action, <span class="keyword">true</span>, TEST_PREFIX);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">throw</span> logic_error(<span class="stringliteral">&quot;Data verification failed&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception &amp;e) {</div>
<div class="line">    TestOutput(action, <span class="keyword">false</span>, TEST_PREFIX, e.what());</div>
<div class="line">  }</div>
<div class="ttc" id="agroup__S3Client_html_gad9e1cbb4715a672101995636897814e4"><div class="ttname"><a href="group__S3Client.html#gad9e1cbb4715a672101995636897814e4">sss::Download</a></div><div class="ttdeci">void Download(const S3DataTransferConfig &amp;cfg, bool sync=false)</div><div class="ttdef"><b>Definition:</b> download-file.cpp:152</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Parallel data transfer</h1>
<p>The following considerations apply to the transfer of single large files over fast connections only (at least 10 Gib/s) and to S3 services able to ingest data at GiB/s rate.</p>
<p>Parallel reads and writes from/to flash memory are faster than serial ones, but with spinning disks the overall performance might not be impacted by trasferring data in parallel and even cause a slowdown.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Lustre</h2>
<p>Lustre allows users to control the striping configuration.</p>
<p>When transferring from <em>Lustre</em> make sure that the stripe size is as close as possible to a multiple of the part size. Use: <code>lfs getstripe &lt;filename&gt;</code> to retrieve the stripe size.</p>
<p>Whe downloading data to <em>Lustre</em> make sure that the stripe size for the directory is a multiple of the part size or create a file with the desired stripe size first using the <code>lfs setstripe</code> command.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Others</h2>
<p><em>RAID</em> configurations and other parallel filesystems, like <em>GPFS</em> or <em>BeeGFS</em> have preconfigured stripe/block sizes, please do refer to your system configuration before configuring the number of tasks and parts per task. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
